# 7.5.7.2 保护时隙（GTS）的分配
>在G3标准中该部分不相关，也就是未使用

　　设备通过MLME-GTS.request原语命令请求分配一个新的保护时隙，并根据应用的需要设置保护时隙的特性。

　　为了请求分配一个新的保护时隙，MLME将给PAN协调器发送保护时隙请求命令（见7.3.9节）。请求命令的GTS特性字段中的特性类型子字段设置为1（GTS分配），并根据所需的GTS特性设置其长度和方向字段。因为GTS请求命令包含确认请求（见7.3.3.1节），PAN协调器应发送一个确认帧来确认接收。

　　PAN协调器一旦收到表明GTS分配请求的命令后，将首先根据竞争期中所剩余的长度和请求的GTS长度，检查在当前超帧中是否有足够的容量。如果没有达到保护时隙的最大数目，并且所需分配长度的GTS不会将竞争期的长度减少到小于aMinCAPLength,则超帧具有有效的容量。只要PAN协调器能有效地提供足够的宽度，就会根据先来先服务的原则分配保护时隙。PAN协调器应在aGTSDescPersistenceTime超帧时间内作出分配保护时隙的决定。

　　设备一旦接收到GTS请求命令的确认后，将继续跟踪信标，并最多等待aGTSDescPersistenceTime超帧时间，如果在这段时间内，没有在信标中出现给该设备的GTS描述符，则MLME将发送状态为NO_DATA的MLME-GTS.confirm原语（见7.1.7.2节），通知上层GTS请求命令失败。

　　当PAN协调器确定有足够的容量满足GTS的请求时，将产生一个带有请求规范和请求设备16位短地址的GTS描述符。如果成功分配GTS，PAN协调器将把GTS描述符中的起始时隙设置为GTS起始的超帧时隙，把GTS描述符中的长度设置为GTS的长度。除此之外，PAN协调器通过MLME发送带有已分配的GTS特性的MLME-GTS.indication原语（见7.1.7.3节），通知上层有新的GTS分配。如果没有足够的容量分配所要求的GTS，起始时隙将设置为0，长度将设置为目前支持的最大的GTS长度。PAN协调器将在其信标帧中包含此GTS描述符，并对信标帧的GTS规范子字段作相应的更新。PAN协调器还将更新信标帧的超帧规范字段中的最终竞争期时隙子字段，表明减少的CAP所使用的最终超帧时隙。GTS描述符将在信标帧中保留aGTSDescPersistenceTime个超帧时间，此后，它将被自动删除。允许PAN协调器把竞争期降低至aMinCAPLength以下，以满足包含GTS描述符造成的信标帧长度的暂时增加。

　　设备收到相应macShortAddress所包含的GTS描述符的信标帧之后，将处理该描述符。设备通过MLME发送MLME-GTS.confirm原语通知上层是否成功分配GTS。如果GTS描述符中的起始时隙大于0，原语的状态为SUCCESS；如果起始时隙等于0或者长度与所请求的长度不相等，状态为DENIED。
