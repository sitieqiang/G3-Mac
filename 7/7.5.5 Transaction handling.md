# 7.5.5 事务处理
>在G3标准中该部分不相关，也就是未使用

　　因为此标准使得设备成本非常低，如采用电池供电等，因此，事务处理通常由设备本身，而不是协调器，来发起。也就是说，协调器要在信标帧中表明有需要设备处理的信息，或者设备必须轮询协调器以确定是否有需要他们处理的信息，这种传输称为间接传输。

　　协调器在接收到间接传输请求后开始进行事务处理，该请求为上层发送的MCPS-DATA.request原语或者来自MLME上层发送的MAC命令请求，如MLME-ASSOCIATE.response原语(见7.1.3.3节)。处理完成后，MAC层将向上层表明其状态信息。如果请求原语开始间接发送，相应的确认原语将用来传递适当的状态值。相反地，如果响应原语开始间接发送，MLME-COMM-STATUS.indication原语将用来传递适当的状态值。通过检查目标地址字段可发现该原语与它的相应的响应原语相关。

　　包含在间接发送请求中的信息形成一个事务，协调器应该具有最少存储一个事务的能力。设备一旦接收到间接发送请求，但是没有存储另一个事务的容量，MAC层将用适当的相应原语把状态值TRANSACTION_OVERFLOW通报上层。

　　如果协调器能够存储多个事务，它应确保同一设备的所有事务按照它们到达MAC层的顺序发送。在发送的事务期间，如果有另一个该设备的事务存在，MAC层将把其帧未决子字段设置为1，表示还有另外的未决数据。

　　每一个设备最多在协调器中的持续时间为macTransactionPersistenceTime。如果在这段时间内事务没有被所对应的设备提取，协调器将丢弃事务信息，并且MAC层将向上层发送一个参数状态为TRANSACTION_EXPIRED的适当相应原语。为了被成功提取，协调器应收到确认帧。

　　如果事务处理成功，该事务信息将被丢弃，MAC层将向上层发送一个状态为SUCCESS的适当相应原语。

　　如果协调器发送信标，它将在地址列表字段中列出与每一个事务相关设备的地址，并在信标帧的未决地址规范字段中给出其地址的数量。如果协调器能够存储多于7个的未决事务，它将在其信标帧中以先进先服务的原则进行表明，以确保信标帧最多含有7个地址。对于需要保护时隙发送的事务来说，PAN协调器将不在其信标帧的未决地址列表中加接收者的地址，而是在分配给对应设备的保护时隙（见7.5.7.3节）中发送该事务。

　　在支持信标的PAN中，如果有一个广播地址未决的事务，信标帧中帧控制字段的帧未决子字段应该设置为1，并且应该在信标之后立即用CSMA-CS算法发送该未决消息。如果还有另外一个广播地址未决的事务，它的发送将被延时到下一个超帧。每一个超帧内只允许发送一个广播消息。

　　在支持信标的PAN中，当未决地址列表中所包含其地址的设备在接收到信标后，将试图从协调器提取数据。在不支持信标的PAN中，设备收到MLME-POLL.request原语之后将试图从协调器提取数据。在7.5.6.3节中描述了从协调器中提取未决数据的过程。如果设备收到帧未决子字段设置为1的信标，它将打开接收机，时间为macMaxFrameTotalWaitTime符号，以接收来自协调器的广播数据帧。
