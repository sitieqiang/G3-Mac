# 7.5.1.1 超帧结构
>在G3标准中该部分不相关，也就是未使用

　　在 PAN 网络中，协调器可以使用超帧结构来限定设备对信道的访问时间。通过发送信标帧就能实现超帧限定。超帧分为两个时间段：活跃期和非活跃期。在非活跃期内，协调器进入低功耗模式（即睡眠模式）。

　　变量 *macBeaconOrder(BO)* 和 *macSuperframeOrder(SO)* 用于描述一个超帧结构。BO 决定了协调器传输信标帧的时间间隔 BI，SO 决定了活跃期（包括信标在内）的持续时间 SD，其关系如下：


\(BI = aBaseSuperframeDuration * 2^{BO}\)

\(SD = aBaseSuperframeDuration * 2^{SO}\)　　其中：0 ≤ SO ≤ BO ≤ 14


　　当 BO = 15，协调器不传输信标帧（除非被要求传输信标帧，比如接收到一个信标请求命令），SO 的值将被忽略。

　　每个超帧的活跃期被分为 *aNumSuperframeSlots* 个大小相等的时隙。活跃期由三个部分组成：信标阶段、竞争访问阶段和免竞争阶段。第 0 个时隙用于发送信标。发送信标时不使用 CSMA/CA 机制。在信标结束后，马上进入竞争阶段。如果存在非竞争阶段，则非竞争阶段紧接在竞争阶段后，并持续到帧活跃阶段结束。保护时隙分配在非竞争阶段。

  MAC 子层应当确保超帧时序的完整性，比如补偿时钟漂移误差。

  希望使用超帧结构的 PAN （参考支持信标的 PAN）应当将 *macBeaconOrder* 的值设置在 0 到 14 之间，同时将 *macSuperframeOrder* 的值设置在 0 到 *macBeaconOrder* 之间。

  不希望使用超帧结构的 PAN （参考不支持信标的 PAN）应将 *macBeaconOrder*
和 *macSuperframeOrder* 的值设置为 15。在这种情况下，除非收到信标请求命令，否则协调器不会发送信标。所有的发送，除确认帧和紧跟在数据请求命令（见7.5.6.3 节）确认之后的数据帧，都使用非时隙的 CSMA/CA 机制访问信道。除此之外，超帧结构中也支持保护时隙。

　　图 66 给出了一个超帧结构的实例。在这种情况下，信标间隔 BI 是超帧活跃期持续时间 SD 的两倍，且在非活跃期内包含两个保护时隙。

<center><img src="../images/Image 66.png"/></center>
<center>图 66. 超帧结构的实例</center>
## 7.5.1.1.1. 竞争接入阶段CAP

　　在一个超帧内，信标帧之后紧接着就是竞争接入阶段。竞争接入阶段必须在免竞争阶段开始之前完成。如果免竞争阶段的长度是 0，那么竞争接入阶段就必须在超帧的有效期结束之前完成。在一般情况下，竞争接入阶段应当大于 *aMinCAPLength*，但是有时为了维护保护时隙，需要增加信标帧的长度，因此需要临时额外的空间，导致竞争接入阶段小于 *aMinCAPLength*。为了自适应免竞争阶段的尺寸，也需要动态地缩减或增加空间。

　　所有的帧，除确认帧和紧跟随确认帧之后的数据帧之外，在竞争接入阶段都需要使用 CSMA/CA 机制访问信道。如果设备想在一个竞争接入阶段内传输，它必须保证其传输过程在该超帧的免竞争阶段之前完成，否则需要等到下一个超帧的竞争接入阶段才能开始传输。

　　MAC 命令帧总是在竞争接入阶段被传输。
### 7.5.1.1.2 免竞争阶段CFP(Contention-free period)

　　免竞争阶段开始于竞争接入阶段最后的时隙边界，结束于超帧活跃期最后的时隙边界。如果 PAN 协调器分配了保护时隙，则这些保护时隙应该处于免竞争阶段内，且占据连续的时序。免竞争阶段应根据所绑定的保护时隙总长度进行增长或缩减。
　　
　　免竞争阶段内访问信道时不需要使用 CSMA/AC 机制。设备在免竞争阶段内传输数据时，必须保证在保护时隙结束之前的最后一个帧间间隔内完成。
