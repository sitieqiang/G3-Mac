# 7.5.6.2 接收和拒绝
>在G3标准中该部分作为规范

　　每一个设备都可以选择MAC层是否在空闲时间打开其接收机。在这段空闲时间里，MAC层仍然为来自上层的收发机任务请求提供服务。收发机任务定义为带有确认接收（如果需要）的收发请求。每次收发任务结束时，MAC层将根据macBeaconOrder和macRxOnWhenIdle的值来请求物理层打开或关闭它的接收机。如果macBeaconOrder少于15，只有在输入超帧的CAP空闲时间内才认为macRxOnWhenIdle的值与之相关。如果macBeaconOrder等于15，macRxOnWhenIdle的值将在所有时间里被认为与之相关。

　　由于无线通信的特性，设备接收机工作时，除接收和解调所有符合此标准，工作在同一信道，且在POS字段的设备所发送的信标外，同时也接收其他发射机对其所产生的干扰信标。因此，MAC层应具有对输入的帧信标进行滤波的能力，滤出上层需要的帧并将其发送给上层。

　　MAC层作为滤波的第一级，它将丢弃在帧的MFR（见7.2.1.9节）的FCS字段中不包含正确值的所有接收帧。在收到帧时，将通过在其MHR和MAC有效载荷上重新计算预期的FCS，然后将该FCS值与接收到的FCS字段进行比较来检验FCS字段。如果这两个值相同，则认为接收帧的FCS字段是正确的，否则不正确。

　　滤波的第二级取决于MAC层当前是否工作在混杂模式。在混杂模式下，MAC层在第一级滤波后，将所有的帧直接发送给上层而不进行更多的过滤。如果macPromiscuousMode设置为TRUE，MAC层将工作在混杂模式。

　　如果MAC层不工作在混杂模式（即macPromiscuousMode设置为FALSE），它将只接收满足下列所有第三滤波条件的帧：

　　——帧类型子字段不包含保留帧类型

　　——帧版本子字段不包含保留值

　　——如果帧中包含目标PAN标识符，则应与macPANId匹配或者为广播PAN标识符（0xffff）

　　——如果帧中包含短目标地址，它应与macShortAddress匹配或者为广播地址（0xffff）。否则如果帧中包含扩展目标地址，它应与aExtendedAddress匹配。

　　——如果帧类型表明该帧为信标帧，源PAN标识符应与macPANId匹配，除非macPANId等于0xffff，在这种情况下，无论源PAN标识符为何值，都要接受该信标帧。

　　——如果在数据帧或者MAC命令帧中仅包含源地址字段，则只有当此设备为PAN协调器，并且源PAN标识符与macPANId匹配时，此帧才会被接收。

　　如果不满足上述任何一个条件，MAC将丢弃该输入帧，不再对它进行进一步处理。如果满足上述所有条件，才会认为该帧为有效帧并对其进行进一步处理。对于非广播类型的有效帧，如果帧类型子字段表示为数据帧或者MAC命令帧，并且帧控制字段中的确认请求子字段设置为1，MAC层将发送确认帧。在发送确认帧之前，接收到的数据帧或者MAC命令帧中的序列号将被复制到确认帧的序列号中。这样，使事务的发起者得知它已收到了相应的确认帧。

　　如果帧控制字段中的PANID密集子字段设置为1并且帧中包含目标和源寻址信息，MAC层将认为省略的源PAN标识符字段和目标PAN标识符字段相同。

　　设备将使用7.5.8.2.3节中所述的输入帧安全过程处理该帧。

　　如果输入帧安全过程的状态不是SUCCESS，MLME将发送相应确认原语或者MLME-COMM-STATUS.indication原语，状态参数设置为输入帧安全过程中指示的错误状态，安全相关参数设置为由非安全处理过程返回的相应参数。如果有效帧为数据帧，MAC层将把该帧送到上层。该过程可通过发送包含帧信息的MCPS-DATA.indiction原语来实现。MCPS-DATA.indiction原语的安全相关参数应设置为由非安全处理过程返回的相应参数。

　　如果有效帧为MAC命令帧或者信标帧，它将被MAC层处理，相应的确认或指示原语将被送到上层。相应的确认或指示原语的安全相关参数将设置为由非安全处理过程返回的相应参数。
